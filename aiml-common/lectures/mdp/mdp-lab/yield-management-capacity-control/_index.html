
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Optimal Capacity Control &#8212; Data Mining</title>
    
  <link href="../../../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/togglebutton.js"></script>
    <script src="../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://pantelis.github.io/data-mining/aiml-common/lectures/mdp/mdp-lab/yield-management-capacity-control/_index.html" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Mining</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Data Science
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ai-intro/course-introduction/_index.html">
   Course Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ai-intro/data-science-360/_index.html">
   Data Science 360
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Probabilistic Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ml-math/probability/_index.html">
   Probability Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../entropy/_index.html">
   Entropy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pgm/bayesian-inference/_index.html">
   Bayesian Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../classification/covid19-antibody-test/_index.html">
   COVID-19 Antibody Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pgm/bayesian-coin/_index.html">
   Bayesian Coin Flipping
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Learning Problem
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../regression/linear-regression/_index.html">
   Linear Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../optimization/sgd/_index.html">
   Stochastic Gradient Descent
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Classification
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../classification/classification-intro/_index.html">
   Introduction to Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../classification/logistic-regression/_index.html">
   Logistic Regression
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Trees and Intelligence of the Crowds
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../decision-trees/_index.html">
   Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ensemble/_index.html">
   Ensemble Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ensemble/random-forests/_index.html">
   Random Forests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ensemble/boosting/_index.html">
   Boosting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ensemble/boosting-workshop/_index.html">
   Boosting workshop
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Non-Parametric Methods
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../unsupervised/k-means/_index.html">
   K-means Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../density-estimation/knn/_index.html">
   k-Nearest Neighbors (kNN) Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../density-estimation/knn-workshop/_index.html">
   kNN Workshop
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Neural Networks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../classification/perceptron/_index.html">
   The Neuron (Perceptron)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../dnn/dnn-intro/_index.html">
   Deep Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../dnn/backprop-intro/_index.html">
   Introduction to Backpropagation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../dnn/backprop-dnn/_index.html">
   Backpropagation in Deep Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cnn/cnn-intro/_index.html">
   Introduction to Convolutional Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cnn/cnn-layers/_index.html">
   CNN Architectures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cnn/cnn-example-architectures/_index.html">
   CNN Example Architectures
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dimensionality Reduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../recommenders/recommenders-intro/_index.html">
   Recommender System Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../recommenders/netflix/_index.html">
   The Netflix Prize and Singular Value Decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pca/_index.html">
   Principal Component Analysis (PCA)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Math Background
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../linear-algebra/vectors/_index.html">
   Vectors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../linear-algebra/matrices/_index.html">
   Matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ml-math/calculus/_index.html">
   Calculus
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../python/_index.html">
   Learn Python
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://pantelis.github.io/data-mining/issues/new?title=Issue%20on%20page%20%2Faiml-common/lectures/mdp/mdp-lab/yield-management-capacity-control/_index.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#single-resource-capacity-control">
   Single Resource Capacity Control
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-class-model">
     Two class model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-programming-solution">
     Dynamic Programming Solution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculating-the-optimal-protection-limit-and-maximum-revenue">
       Calculating the Optimal Protection Limit and Maximum Revenue
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-multiple-class-model">
     The Multiple Class Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Optimal Capacity Control</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#single-resource-capacity-control">
   Single Resource Capacity Control
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-class-model">
     Two class model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-programming-solution">
     Dynamic Programming Solution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculating-the-optimal-protection-limit-and-maximum-revenue">
       Calculating the Optimal Protection Limit and Maximum Revenue
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-multiple-class-model">
     The Multiple Class Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="optimal-capacity-control">
<h1>Optimal Capacity Control<a class="headerlink" href="#optimal-capacity-control" title="Permalink to this headline">¶</a></h1>
<div class="section" id="single-resource-capacity-control">
<h2>Single Resource Capacity Control<a class="headerlink" href="#single-resource-capacity-control" title="Permalink to this headline">¶</a></h2>
<p>In this section we outline a capacity control policy that is routinely used in various industries (airlines, car rentals, hospitality) to make reservations towards a perishable capacity-constrained resource.</p>
<p>Your job is to determine the knobs that implement the policy in a reservation system where customers are arriving to making a booking. We treat the simplest possible problem of a single resource. The intuition behind the heavy math below is simple<a class="footnote-reference brackets" href="#id2" id="id1">1</a>.</p>
<p>Capacity should be allocated to a request if and only if its revenue is greater than the value of the capacity required to satisfy the request. Second the value of capacity should be measured by its <em>expected displacement cost</em> or opportunity cost which is the expected loss in future revenue from using the capacity now rather than protecting it for future use.</p>
<p><strong>The opportunity cost is captured using a value function <span class="math notranslate nohighlight">\(V(x)\)</span> that measures the optimal expected revenue as a function of the remaining capacity <span class="math notranslate nohighlight">\(x\)</span>. The opportunity cost is then the difference between the <span class="math notranslate nohighlight">\(V(x)-V(x-1)\)</span>. This simply means that estimating the value function accurately is the most important requirement in our problem</strong>.</p>
<div class="section" id="two-class-model">
<h3>Two class model<a class="headerlink" href="#two-class-model" title="Permalink to this headline">¶</a></h3>
<p>Let us assume that we are interested in allocating a resource of capacity <span class="math notranslate nohighlight">\(C\)</span>, to two different classes of consumers.Each class is represented by a price that consumers in this class will need to pay for one unit of this resource. Let <span class="math notranslate nohighlight">\(p_d\)</span>/<span class="math notranslate nohighlight">\(p_f\)</span> and <span class="math notranslate nohighlight">\(D_d\)</span>/<span class="math notranslate nohighlight">\(D_f\)</span> represent the prices and demands for the discounted/full-price classes respectively. The assumptions behind our model are:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_d &lt; p_f\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(D_d\)</span> and <span class="math notranslate nohighlight">\(D_f\)</span> are independent random variables i.e. <span class="math notranslate nohighlight">\(p(D_d|D_f) = p(D_d)\)</span>.</p></li>
</ul>
<p>The type <span class="math notranslate nohighlight">\(d\)</span> demand arrives before type <span class="math notranslate nohighlight">\(f\)</span> demand. This time dependency is not important and in practice it has been shown that does not result into significant deviations from optimality.</p>
<p>Our aim is to find the a-priori protection level <span class="math notranslate nohighlight">\(y\)</span> that represents the resource units that will be reserved for allocation to the type <span class="math notranslate nohighlight">\(f\)</span> traffic.</p>
<p>The maximum number of resource units that can be allocated to type <span class="math notranslate nohighlight">\(d\)</span>, i.e. the <strong>available capacity</strong> for type <span class="math notranslate nohighlight">\(d\)</span>, will then be,</p>
<div class="math notranslate nohighlight">
\[C_d = C-y\]</div>
<p>The units that can be occupied by type <span class="math notranslate nohighlight">\(d\)</span> cannot exceed the corresponding demand for this type i.e.,</p>
<div class="math notranslate nohighlight">
\[S_d = \min (C_d,D_d)\]</div>
<p>Therefore the maximum number of resource units that can be allocated to type <span class="math notranslate nohighlight">\(f\)</span>, i.e. the <em>available capacity</em> for type <span class="math notranslate nohighlight">\(f\)</span>, will then be,</p>
<div class="math notranslate nohighlight">
\[C_f = C - \min (C_d,D_d) = \max(y,C-D_d)\]</div>
<p>The units that will be occupied by type <span class="math notranslate nohighlight">\(f\)</span> is then,</p>
<div class="math notranslate nohighlight">
\[S_f = \min (C_f,D_f)\]</div>
<p>The expected revenue from the occupied resources will be</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbb E \\{ p_d  S_d + p_f  S_f \\}\end{split}\]</div>
<p>where the expectation is taken over the random demands of the two types. If we maximize revenue over the protection level <span class="math notranslate nohighlight">\(y\)</span>, we obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}
V_d(C) = \max_{0 \le y \le C} \mathbb E \\{p_d  S_d + p_f  S_f \\}  = \end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split} = \max_{0 \le y \le C} \mathbb E \\{p_d  \min (C-y,D_d) + p_f \min \left( \max(y,C-D_d),D_f \right) \\} 
\end{split}\]</div>
<p>Intuitively, the ratio of the prices <span class="math notranslate nohighlight">\(r=\frac{p_d}{p_f}\)</span> can help us determine some trends in setting the reservation level <span class="math notranslate nohighlight">\(y\)</span>. For if the ratio is very small, i.e. <span class="math notranslate nohighlight">\(p_f &gt;&gt; p_d\)</span>, then we would be inclined to reserve most of the overall capacity <span class="math notranslate nohighlight">\(C\)</span> for type <span class="math notranslate nohighlight">\(f\)</span> i.e <span class="math notranslate nohighlight">\(C_f &gt;&gt; C_d\)</span>. If on the other hand the ratio is close to 1, then we would be inclined to reserve only a very small capacity for type <span class="math notranslate nohighlight">\(f\)</span> i.e. <span class="math notranslate nohighlight">\(C_f &lt;&lt; C_d\)</span>, since we can get almost the same revenue with type <span class="math notranslate nohighlight">\(d\)</span>.</p>
<p>Let us assume now that we set a fixed price ratio <span class="math notranslate nohighlight">\(r\)</span> that is not close to these two extremes, and we then look at the remaining factors that can determine <span class="math notranslate nohighlight">\(y\)</span> for optimal revenue. From the expressions above that factor seems to be the shape of the tail of the demand function for type <span class="math notranslate nohighlight">\(f\)</span> i.e. <span class="math notranslate nohighlight">\(p(D_f &gt; y)\)</span>. This is because we can only have the revenue for the capacity we reserved, if the associated demand is there i.e. if <span class="math notranslate nohighlight">\(D_f &gt; y\)</span>. We can use Dynamic Programming (DP) to calculate the optimal reservation/protection limit.</p>
</div>
<div class="section" id="dynamic-programming-solution">
<h3>Dynamic Programming Solution<a class="headerlink" href="#dynamic-programming-solution" title="Permalink to this headline">¶</a></h3>
<p>To use a dynamic programming problem formulation, we need to define the variables at the beginning of the two periods involved.</p>
<p>The first period is defined as the point just before the type <span class="math notranslate nohighlight">\(d\)</span>  demand is observed i.e. when the available capacity is <span class="math notranslate nohighlight">\(C\)</span> and we define the value function <span class="math notranslate nohighlight">\(V_d(C)\)</span> that represents the optimal expected revenue starting with <span class="math notranslate nohighlight">\(C\)</span> units of capacity. Apparently an upper bound of this value function is <span class="math notranslate nohighlight">\(V_d(C) \le p_f C\)</span>, and this is obtained when we protect all the available capacity for type <span class="math notranslate nohighlight">\(f\)</span>.</p>
<p>Similarly, the second variable is the value function <span class="math notranslate nohighlight">\(V_f(x)\)</span> that represents the optimal expected revenue starting with <span class="math notranslate nohighlight">\(x\)</span> units of capacity just before observing <span class="math notranslate nohighlight">\(D_f\)</span> or equivalently after we observe <span class="math notranslate nohighlight">\(D_d\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}V_f(x) = \mathbb{E} \\{p_f  \min(x,D_f)\\}  =  p_f  \sum_{j=1}^x p(D_f \ge j)\end{split}\]</div>
<p>where we have expanded <span class="math notranslate nohighlight">\(\mathbb E \\{\min(x,D) \\}\)</span> using the rationale below.</p>
<p>Suppose that <span class="math notranslate nohighlight">\(D\)</span> an integer quantity with <span class="math notranslate nohighlight">\(D &gt; 0\)</span> and <span class="math notranslate nohighlight">\(x\)</span> is an integer, then,</p>
<div class="math notranslate nohighlight">
\[E\{\min(x,D)\} = \sum_{j=0}^\infty \min(x,j)  Pr(D=j) \]</div>
<div class="math notranslate nohighlight">
\[ =  0  Pr(D=0) + 1  Pr(D=1) + \dots + x  Pr(D=x) + x  Pr(D=x+1) + \dots \]</div>
<div class="math notranslate nohighlight">
\[ Pr(D \ge 1) + Pr(D \ge 2) + \dots + Pr(D \ge x) =  \sum_{j=1}^x Pr(D \ge j) \]</div>
<p>The dynamic program formulation would involve relating <span class="math notranslate nohighlight">\(V_d(C)\)</span> to <span class="math notranslate nohighlight">\(V_f(x)\)</span>. If we rewrite <span class="math notranslate nohighlight">\(V_d(C)\)</span> from the result of the previous section,</p>
<div class="math notranslate nohighlight">
\[\begin{split} V_d(C)  =  \max_{0 \le y \le C}  \mathbb E \\{p_d \min (C-y,D_d)\\} +  \mathbb E \\{ V_f(C_f) \\}  = \end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split} =  \max_{0 \le y \le C}    \mathbb E \\{ p_d \min (C-y,D_d) \\} +  \mathbb E \\{ V_f(\max(y,C-D_d)) \\} = \max_{0 \le y \le C} W(y,C)\end{split}\]</div>
<p>The revenue difference from one unit of protection level is given by,</p>
<div class="math notranslate nohighlight">
\[\Delta W(y,C) = W(y,C) - W(y-1,C) = [p_f p(D_f \ge y) - p_d] p(D_d \ge C-y)\]</div>
<p>We can prove the last equality as follows</p>
<div class="math notranslate nohighlight">
\[\begin{split} W(y,C) = \mathbb E \\{p_d \min (C-y,D_d) + V_f(\max(y,C-D_d)) \\} \end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}W(y-1,C) = \mathbb E \\{p_d \min (C-y+1,D_d) + V_f(\max(y-1,C-D_d)) \\}\end{split}\]</div>
<p>We can study two cases:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Case</p></th>
<th class="text-align:left head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(D_d \le C-y\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\( \Delta W(y,C) = W(y,C) - W(y-1,C)\)</span></p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\( = \mathbb E \\{p_d D_d + V_f(C-D_d) \\} - \mathbb E \\{p_d D_d + V_f(C-D_d)\\} \)</span></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\( = \mathbb E \\{0 p(D_d \le C-y) \\} =0 \)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(D_d &gt; C-y\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\( \Delta W(y,C) = W(y,C) - W(y-1,C)\)</span></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(= \mathbb E \\{p_d (C-y) + V_f(y) \\} - \mathbb E \\{p_d (C-y+1) + V_f(y-1) \\}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(= \mathbb E \\{ V_f(y)-V_f(y-1)-p_d \\} p(D_d &gt; C-y)\)</span></p></td>
</tr>
</tbody>
</table>
<p>Then in all cases, the difference,</p>
<p><span class="math notranslate nohighlight">\(\Delta W(y,C) = W(y,C) - W(y-1,C)\)</span>
<span class="math notranslate nohighlight">\(= \mathbb E \\{V_f(y)-V_f(y-1)-p_d \\} p(D_d &gt; C-y)\)</span>
<span class="math notranslate nohighlight">\(= \mathbb E \\{\Delta V_f(y)-p_d \\} p(D_d &gt; C-y)\)</span></p>
<p>If we replace the marginal of the value function <span class="math notranslate nohighlight">\(V_f(y)\)</span>, with <span class="math notranslate nohighlight">\(\Delta V_f(y) = V_f(y)-V_f(y-1) = p_f  p(D_f \ge y)\)</span> we get the final result:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\Delta W(y,C) = W(y,C) - W(y-1,C) = \mathbb E \\{ p_f  p(D_f \ge y)-p_d \\} p(D_d &gt; C-y)\end{split}\]</div>
<p>The term is <span class="math notranslate nohighlight">\(\Delta V_f(y)- p_d\)</span> will start positive and then become negative i.e. the marginal value will have at least a local maximum. This can be simply shown if one replaces <span class="math notranslate nohighlight">\(y\)</span> with <span class="math notranslate nohighlight">\(\infty\)</span> which causes the term <span class="math notranslate nohighlight">\(p_f  p(D_f \ge y)-p_d \rightarrow -p_d\)</span> and in the other extreme, if we replace <span class="math notranslate nohighlight">\(y\)</span> with <span class="math notranslate nohighlight">\(0\)</span> the term <span class="math notranslate nohighlight">\(p_f  p(D_f \ge y)-p_d \rightarrow p_f-p_d\)</span>.</p>
<p>Note that the marginal value <span class="math notranslate nohighlight">\(V_f(x)\)</span> itself reduces with remaining capacity <span class="math notranslate nohighlight">\(x\)</span>. The marginal value depends on how much the tail of the type-<span class="math notranslate nohighlight">\(d\)</span> demand exceeds the available capacity.</p>
<div class="section" id="calculating-the-optimal-protection-limit-and-maximum-revenue">
<h4>Calculating the Optimal Protection Limit and Maximum Revenue<a class="headerlink" href="#calculating-the-optimal-protection-limit-and-maximum-revenue" title="Permalink to this headline">¶</a></h4>
<p>The optimal <span class="math notranslate nohighlight">\(y\)</span>, denoted by <span class="math notranslate nohighlight">\(y^*\)</span> can now be found as,</p>
<div class="math notranslate nohighlight">
\[\begin{split}y^* = \max \\{ y \in N_+: p_f  p(D_f \ge y^*) \ge p_d \\} = \max \\{ y \in N: p(D_f \ge y^*) \ge \frac{p_d}{p_f} \\}\end{split}\]</div>
<p>The optimal booking limit will then be</p>
<div class="math notranslate nohighlight">
\[b^* = (C-y^*)^+\]</div>
<p>The maximum possible revenue starting with capacity <span class="math notranslate nohighlight">\(C\)</span> is given by,</p>
<div class="math notranslate nohighlight">
\[\begin{split}V_d(C) =  \begin{cases} W(y^*,C) &amp; \text{if } y^* \le C \\\\ W(C,C) &amp; \text{if } y^* &gt; C \end{cases}\end{split}\]</div>
<p>Calculating <span class="math notranslate nohighlight">\(W(y^*,C)\)</span> can be done recursively. We know that,</p>
<div class="math notranslate nohighlight">
\[\begin{split}W(y,C)  =  W(y-1,C)  + \mathbb E \\{p_f  p(D_f \ge y)-p_d \\} p(D_d &gt; C-y)\end{split}\]</div>
<p>To start the iteration we need <span class="math notranslate nohighlight">\(W(0,C)\)</span> that can be written as,</p>
<div class="math notranslate nohighlight">
\[\begin{split}W(0,C) = p_d  \mathbb E \\{\min(C,D_d)\\} + \mathbb E \\{V_f(\max(0,C-D_d))\\}\end{split}\]</div>
<p>The first expectation can be written using partial expectations as,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbb E \\{\min(C,D_d)\\} = \sum_{j=1}^C p(D_d \ge j)\end{split}\]</div>
<p>The second expectation can be written as,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbb E \\{V_f(\max(0,C-D_d))\\} = \sum_{j=0}^C V_f(C-j) p(D_d = j)\end{split}\]</div>
<p>Then, starting from <span class="math notranslate nohighlight">\(W(0,C)\)</span> we can calculate <span class="math notranslate nohighlight">\(W(1,C)\)</span> and iterate until all <span class="math notranslate nohighlight">\(W(y^\*,C)\)</span> are calculated.</p>
</div>
</div>
<div class="section" id="the-multiple-class-model">
<h3>The Multiple Class Model<a class="headerlink" href="#the-multiple-class-model" title="Permalink to this headline">¶</a></h3>
<p>The value function for the multi-class problem is given by,</p>
<div class="math notranslate nohighlight">
\[V_j(x) = \sum_{k=0}^{x-y-1} \left[p_j k + V_{j-1}(x-k) \right] p(D_j=k) + \left[p_j(x-y) + V_{j-1}(y)\right] p(D_j \ge x-y)\]</div>
<p>The implementation in Matlab as shown in the next listing.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>Resource<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">value_function</span><span class="p">(</span>Resource,stage,inpstruct<span class="p">)</span><span class="w"></span>

<span class="c">% vector of all potential states (states represent the </span><span class="w"></span>
<span class="c">% remaining capacity)</span><span class="w"></span>
<span class="n">x</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">inpstruct</span><span class="p">.</span><span class="n">Num_States</span><span class="p">;</span><span class="w"></span>


<span class="c">% the pdf of the demand for this stage - P(D_j == x)</span><span class="w"></span>
<span class="n">demand_pdf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">poisspdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">inpstruct</span><span class="p">.</span><span class="n">mean_D</span><span class="p">(</span><span class="n">stage</span><span class="p">));</span><span class="w"></span>

<span class="c">% the complementary cdf of the demand for this stage - P(D_j &gt;= x)</span><span class="w"></span>
<span class="n">demand_ccdf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="o">-</span><span class="n">poisscdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">inpstruct</span><span class="p">.</span><span class="n">mean_D</span><span class="p">(</span><span class="n">stage</span><span class="p">));</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="n">stage</span><span class="o">==</span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="c">% The optimal protection level for this initial stage</span><span class="w"></span>
<span class="w">    </span><span class="n">y_star_prev</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="c">% The optimal protection level for this and subsequent stages</span><span class="w"></span>
<span class="w">    </span><span class="n">y_star_prev</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Resource</span><span class="p">{</span><span class="n">stage</span><span class="o">-</span><span class="mi">1</span><span class="p">}.</span><span class="n">Protection_Level</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">T</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">inpstruct</span><span class="p">.</span><span class="n">C</span><span class="p">,</span><span class="n">inpstruct</span><span class="p">.</span><span class="n">C</span><span class="p">);</span><span class="w"></span>
<span class="c">% Calculate the value function V (note that we are reusing x defining </span><span class="w"></span>
<span class="c">%it as the state index)</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">inpstruct</span><span class="p">.</span><span class="n">Num_States</span><span class="w"></span>
<span class="w">    </span><span class="n">Resource</span><span class="p">{</span><span class="n">stage</span><span class="p">}.</span><span class="n">T</span><span class="p">(</span><span class="n">x</span><span class="p">,:)=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">x</span><span class="o">-</span><span class="n">y_star_prev</span><span class="w">        </span>
<span class="w">        </span><span class="n">T</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">k</span><span class="p">)=</span><span class="w"> </span><span class="p">(</span><span class="n">inpstruct</span><span class="p">.</span><span class="n">price</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">        </span><span class="n">Resource</span><span class="p">{</span><span class="n">stage</span><span class="o">-</span><span class="mi">1</span><span class="p">}.</span><span class="n">V</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="n">k</span><span class="p">)))</span><span class="o">*</span><span class="w"> </span><span class="n">demand_pdf</span><span class="p">(</span><span class="n">k</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="n">Resource</span><span class="p">{</span><span class="n">stage</span><span class="p">}.</span><span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">x</span><span class="p">,:))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="n">inpstruct</span><span class="p">.</span><span class="n">price</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span><span class="o">*</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="n">y_star_prev</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">             </span><span class="n">Resource</span><span class="p">{</span><span class="n">stage</span><span class="o">-</span><span class="mi">1</span><span class="p">}.</span><span class="n">V</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y_star_prev</span><span class="p">))))</span><span class="w"> </span><span class="o">*</span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="n">demand_ccdf</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="n">y_star_prev</span><span class="p">));</span><span class="w">      </span>
<span class="k">end</span><span class="w"></span>

<span class="c">% Calculate the marginal value of a single resource unit (DeltaV)</span><span class="w"></span>
<span class="n">deltaV</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">diff</span><span class="p">(</span><span class="nb">cat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Resource</span><span class="p">{</span><span class="n">stage</span><span class="p">}.</span><span class="n">V</span><span class="p">));</span><span class="w"></span>
<span class="n">Resource</span><span class="p">{</span><span class="n">stage</span><span class="p">}.</span><span class="n">deltaV</span><span class="p">=</span><span class="w"> </span><span class="n">deltaV</span><span class="p">;</span><span class="w"></span>
<span class="c">% find the point of where the marginal value is larger than the price of</span><span class="w"></span>
<span class="c">% the next stage </span><span class="w"></span>
<span class="n">indeces</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">deltaV</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">inpstruct</span><span class="p">.</span><span class="n">price</span><span class="p">(</span><span class="n">stage</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="n">Resource</span><span class="p">{</span><span class="n">stage</span><span class="p">}.</span><span class="n">Protection_Level</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">indeces</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>A number of calls equal to the number of stages are made. In each call, the corresponding results are stored for usage at the next stage.</p>
<p>For a problem with available initial capacity <span class="math notranslate nohighlight">\(C=100\)</span> and 2 demand classes shown below:</p>
<p>| Class | Price | Demand Distribution | Optimal Protection Levels |
| — | — | — | — | — |
|1 | 1000 | Poisson(40) | 41 |
|2 | 450 | Poisson(15) | 100 |</p>
<p>The marginal value as a function of the remaining resources.</p>
<p><img alt="marginal-value-multi-class" src="../../../../../_images/marginal-value-two-class.png" />
<em>The marginal value as a function of the remaining resources</em></p>
<p>The optimal protection limits are shown below.</p>
<p><img alt="optimal-protection-limits-multi-class" src="../../../../../_images/protection-limits-two-class.png" /></p>
<p>A further example shows the straightforward application of the same DP solution for more classes. The table below outlines the results for an available initial capacity <span class="math notranslate nohighlight">\(C=50\)</span> and 4 demand classes.</p>
<p>| Class | Price | Demand Distribution | Optimal Protection Levels |
| — | — | — | — | — |
|1 | 100 | Poisson(10) | 6 |
|2 | 90 | Poisson(15) | 20 |
|3 | 80 | Poisson(25) | 44 |
|4 | 70 | Poisson(15) | 50 |</p>
<p><img alt="marginal-value-multi-class" src="../../../../../_images/marginal-value-multiclass.png" />
<em>The marginal value as a function of the remaining resources for the three stages of the problem</em></p>
<p>Its noteworthy to highlight the decreasing marginal value of capacity as the remaining capacity increases. This is intuitive as the more capacity we have remaining the less a unit of this capacity should be worth. Also, it is interesting to highlight the increasing value of marginal capacity with increasing stage. This is also intuitive as the earlier we are in stage i.e. the more time we have until we reach the final stage 1, the more a unit of capacity is worth if we allocate it at that stage.</p>
<p>The optimal protection limits are shown below.</p>
<p><img alt="optimal-protection-limits-multi-class" src="../../../../../_images/protection-limits-multi-class.png" /></p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[1] K. Talluri and G Van Ryzin, ‘The Theory and Practice of Revenue Management’, Springer, 2004.</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>It is probably the most essential first step as computer scientists to spend time understanding a domain / problem space and acquire such intuition as to how the system works.</p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./aiml-common/lectures/mdp/mdp-lab/yield-management-capacity-control"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Pantelis Monogioudis, Ph.D<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>